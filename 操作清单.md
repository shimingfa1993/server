# SSL升级操作清单 ✅

## 📋 准备工作

### 1. 文件准备
- [ ] `server-https.js` - HTTPS服务器文件
- [ ] `upgrade-to-ssl.sh` - 自动升级脚本  
- [ ] `check-environment.sh` - 环境检查脚本
- [ ] `lengthwords.top.key` - 阿里云SSL私钥文件
- [ ] `lengthwords.top.pem` - 阿里云SSL证书文件

### 2. 环境确认
- [ ] 确认项目路径为 `/www/english-learning-api`
- [ ] 确认已安装Node.js和PM2
- [ ] 确认域名 `lengthwords.top` 已解析到服务器

## 🚀 升级步骤

### 第1步：上传文件
```bash
# 将所有准备的文件上传到服务器临时目录
# 例如: /tmp/ssl-upgrade/
```

### 第2步：环境检查（可选）
```bash
cd /tmp/ssl-upgrade/
chmod +x check-environment.sh
./check-environment.sh
```

### 第3步：执行升级
```bash
chmod +x upgrade-to-ssl.sh
sudo ./upgrade-to-ssl.sh
```

### 第4步：验证结果
```bash
# 检查PM2状态
pm2 status

# 测试HTTPS API
curl -k https://lengthwords.top/api/test

# 查看HTTPS日志
pm2 logs english-learning-https
```

## 📱 小程序更新

### 代码修改
```javascript
// 更新API基础URL
const API_BASE_URL = 'https://lengthwords.top';
```

### 微信后台配置
1. 登录微信小程序管理后台
2. 进入 `开发` → `开发管理` → `开发设置`  
3. 在 `服务器域名` 中添加：`https://lengthwords.top`

## ✅ 验收标准

- [ ] PM2显示 `english-learning-https` 服务正常运行
- [ ] `curl -k https://lengthwords.top/api/test` 返回成功响应
- [ ] HTTP请求自动重定向到HTTPS
- [ ] 小程序能正常调用HTTPS API
- [ ] 微信小程序后台已配置服务器域名

## 🔧 常用命令

```bash
# 查看服务状态
pm2 status

# 重启HTTPS服务
pm2 restart english-learning-https

# 查看HTTPS日志
pm2 logs english-learning-https

# 查看错误日志
pm2 logs english-learning-https --err

# 监控服务
pm2 monit
```

## 🆘 应急处理

### 如果升级失败
```bash
# 停止HTTPS服务
pm2 stop english-learning-https
pm2 delete english-learning-https

# 检查原HTTP服务
pm2 restart english-learning-api
```

### 如果需要回滚
```bash
cd /www/english-learning-api
cp backup-*/server.js ./
cp backup-*/ecosystem.config.js ./
pm2 restart english-learning-api
```

## 📞 联系方式

如果遇到问题：
1. 查看升级脚本的输出日志
2. 检查PM2服务日志：`pm2 logs english-learning-https --err`
3. 验证防火墙和安全组设置
4. 确认SSL证书文件权限

---

🎯 **目标**: 成功为现有的英语学习小程序后端添加HTTPS支持，确保小程序能够安全访问API！
