# 快速部署说明 🚀

## 📁 文件清单

为了成功部署SSL HTTPS服务，您需要以下文件：

### 必需文件
- ✅ `server-https.js` - 支持HTTPS的服务器文件
- ✅ `ecosystem.config.js` - PM2配置文件（已更新）
- ✅ `package.json` - 项目依赖配置（已更新）
- ✅ `deploy-ssl.sh` - 自动部署脚本
- ✅ `env.example` - 环境变量配置示例
- ✅ `lengthwords.top.key` - 阿里云SSL私钥文件
- ✅ `lengthwords.top.pem` - 阿里云SSL证书文件

### 参考文件
- 📖 `SSL部署指南.md` - 详细部署指南
- 📖 `部署说明.md` - 本文件

## ⚡ 三步快速部署

### 第1步：上传文件到服务器
```bash
# 创建项目目录
sudo mkdir -p /home/english-learning
cd /home/english-learning

# 上传所有必需文件到这个目录
# 使用scp、sftp或其他方式上传文件
```

### 第2步：运行自动部署脚本
```bash
# 给脚本执行权限
chmod +x deploy-ssl.sh

# 以root权限运行部署脚本
sudo ./deploy-ssl.sh
```

### 第3步：验证部署
```bash
# 测试HTTPS API
curl -k https://lengthwords.top/api/test

# 检查PM2状态
pm2 status
```

## 🔧 手动部署命令

如果自动脚本失败，可以使用以下命令手动部署：

```bash
# 1. 创建SSL目录并复制证书
sudo mkdir -p /home/ssl
sudo cp lengthwords.top.key /home/ssl/
sudo cp lengthwords.top.pem /home/ssl/
sudo chmod 600 /home/ssl/lengthwords.top.key
sudo chmod 644 /home/ssl/lengthwords.top.pem

# 2. 创建环境配置
cat > .env << 'EOF'
NODE_ENV=production
HTTP_PORT=80
HTTPS_PORT=443
JWT_SECRET=your-super-secret-key-change-this
SSL_KEY_PATH=/home/ssl/lengthwords.top.key
SSL_CERT_PATH=/home/ssl/lengthwords.top.pem
EOF

# 3. 安装依赖
npm install

# 4. 启动HTTPS服务
pm2 start ecosystem.config.js --only english-learning-https --env production
pm2 startup
pm2 save

# 5. 配置防火墙
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
```

## 📱 小程序配置更新

部署完成后，更新您的小程序代码：

```javascript
// 将API基础URL改为HTTPS
const API_BASE_URL = 'https://lengthwords.top';

// 示例API调用
wx.request({
  url: `${API_BASE_URL}/api/test`,
  method: 'GET',
  success: (res) => {
    console.log('HTTPS API连接成功:', res.data);
  },
  fail: (err) => {
    console.error('API连接失败:', err);
  }
});
```

## 🔍 故障排除

### 常见问题

1. **证书文件不存在**
   - 确保`lengthwords.top.key`和`lengthwords.top.pem`在当前目录
   - 检查文件权限和路径

2. **端口被占用**
   ```bash
   sudo lsof -i :443
   sudo kill -9 <PID>
   ```

3. **防火墙问题**
   - 检查阿里云安全组配置
   - 确保开放80和443端口

4. **PM2服务启动失败**
   ```bash
   pm2 logs english-learning-https
   pm2 restart english-learning-https
   ```

## 📞 技术支持

如果遇到问题：
1. 查看详细的`SSL部署指南.md`
2. 检查服务日志：`pm2 logs english-learning-https`
3. 验证证书有效性：`openssl x509 -in /home/ssl/lengthwords.top.pem -text -noout`

---

🎉 **部署成功后，您的小程序就可以通过HTTPS安全访问API了！**
